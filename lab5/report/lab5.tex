\include{settings}

\begin{document}

\include{titlepage}

\tableofcontents
\newpage

\section{Цели работы}

Познакомиться с возможностями реализации более сложной обработки данных на стороне сервера с помощью хранимых процедур.

\section{Программа работы}

\begin{enumerate}
	\item Изучение возможностей языка \code{PL/pgSQL}.
	\item Создание двух хранимых процедур в соответствии с индивидуальным заданием, полученным у преподавателя.
	\item Выкладывание скрипта с созданными сущностями в репозиторий.
	\item Демонстрация результатов преподавателю.
\end{enumerate}

\section{Хранимая процедура 1}
\paragraph{Задание:} На основании данных о подписках пользователя и о популярности фильмов по категориям сформировать список предложений для заданного пользователя.

В листинге \ref{lst:recommendations.sql} представлена процедура\\ \code{up\_to\_n\_movie\_recommendations\_for\_user(n INTEGER, u\_id BIGINT)}, которая формирует выборку в соответствии с заданием. Она принимает 2 аргумента: \code{n} --- число предложений и \code{u\_id} --- идентификатор пользователя.

\lstinputlisting[caption={recommendations.sql},label={lst:recommendations.sql}]{recommendations.sql}

\section{Хранимая процедура 2}
\paragraph{Задание:} Вывести динамику 10 наиболее популярных категорий за последние три года: количество подписок, изменение относительно предыдущего года в абсолютном и относительном выражении, место в рейтинге и изменение места по сравнению с предыдущим годом.

В листинге \ref{lst:top-categories.sql} представлена процедура\\ \code{top\_10\_categories\_within\_3\_last\_years()}, которая формирует выборку в соответствии с заданием.

\lstinputlisting[caption={top-categories.sql},label={lst:top-categories.sql}]{top-categories.sql}
 
\section{Выводы}

В результате работы были изучены возможности языка \code{PL/pgSQL}, и были разработаны хранимые процедуры, формирующие выборки в соответствии с заданием преподавателя.

\end{document}
